generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = "postgresql://postgres:1234@localhost:5432/kofis_sms_db?schema=public"
}

model User {
  id       String @id @default(uuid())
  email    String @unique
  userName String @unique
  password String
}

model Student {
  id             String     @id @default(uuid())
  first_name     String
  last_name      String
  other_name     String?
  indexNumber    String     @unique
  dob            String
  admission_date String
  passport_url   String?
  guardian       Guardian[]
  gender         Gender
  address        String
  phone          String
  class_id       String
  class          Class      @relation(fields: [class_id], references: [id])
  age            String

  FeePayment FeePayment[]
}

model Class {
  id          String       @id @default(uuid())
  name        String
  description String?
  students    Student[]
  level       LevelForFees
}

model Terms {
  id              String       @id @default(uuid())
  name            String
  startDate       DateTime
  status          termStatus   @default(Upcoming)
  isFeesGenerated Boolean      @default(false)
  accademicYear   String
  endDate         DateTime
  FeePayment      FeePayment[]
  feePlan         FeePlans[]
}

model Subject {
  id          String  @id @default(uuid())
  name        String
  description String?
}

model Guardian {
  id           String  @id @default(uuid())
  name         String
  phone        String
  address      String
  title        String
  relationship String
  studentId    String
  student      Student @relation(fields: [studentId], references: [id], onDelete: Cascade)
}

model FeePlans {
  id     String         @id @default(uuid())
  termId String
  term   Terms          @relation(fields: [termId], references: [id], onDelete: Cascade)
  amount Float
  level  LevelForFees[]

  @@unique([termId, level])
}

model FeePayment {
  id         String         @id @default(uuid())
  amount     Float
  createdAt  DateTime       @default(now())
  termId     String
  studentId  String
  method     paymentMethod?
  status     PaymentStatus
  paidDate   DateTime       @default(now())
  paidAmount Float
  student    Student        @relation(fields: [studentId], references: [id], onDelete: NoAction)
  term       Terms          @relation(fields: [termId], references: [id], onDelete: Cascade)
}

enum Gender {
  Male
  Female
  Other
}

enum LevelForFees {
  Nursery
  Kindergarten
  Primary
  JHS
  SHS
  Other
}

enum termStatus {
  Ongoing
  Completed
  Upcoming
}

enum paymentMethod {
  Cash
  MobileMoney
  BankTransfer
}

enum PaymentStatus {
  Paid
  Unpaid
  Partial
}
